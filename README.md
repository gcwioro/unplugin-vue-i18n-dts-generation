# unplugin-vue-i18n-dts-generation

A Vite plugin for generating TypeScript definitions from virtual i18n modules. This plugin helps you maintain type safety by automatically generating TypeScript definitions for your i18n keys from virtual modules exposed by other plugins.

## Features

- ðŸš€ Automatic TypeScript definition generation from virtual modules
- ðŸ”„ Hot-reload support with file watching in development
- ðŸŽ¯ Deterministic output (no timestamps in generated files)
- ðŸ”§ Highly configurable with sensible defaults
- ðŸ“¦ Lightweight with minimal dependencies
- âš¡ Fast generation with debouncing and caching

## Installation

```bash
npm install -D unplugin-vue-i18n-dts-generation
```

```bash
yarn add -D unplugin-vue-i18n-dts-generation
```

```bash
pnpm add -D unplugin-vue-i18n-dts-generation
```

## Usage

Add the plugin to your `vite.config.ts`:

```typescript
import { defineConfig } from 'vite'
import unpluginVueI18nDtsGeneration from 'unplugin-vue-i18n-dts-generation'

export default defineConfig({
  plugins: [
    // Your other plugins that expose virtual modules...
    
    // This plugin should come after the plugin that provides the virtual module
    unpluginVueI18nDtsGeneration({
      sourceId: 'virtual:i18n-messages', // The virtual module ID to read from
      dtsPath: 'src/types/i18n.d.ts',    // Where to write the TypeScript definitions
    })
  ]
})
```

## Configuration

### Options

```typescript
interface VirtualKeysDtsOptions {
  /**
   * The module id that another plugin exposes virtually, e.g. "virtual:routes".
   * This should be exactly what you'd import in user-land code.
   * @required
   */
  sourceId: string

  /**
   * Which export to read from the virtual module.
   * @default "default"
   */
  exportName?: string

  /**
   * Path where the generated .d.ts file should be written.
   * Can be absolute or relative to Vite root.
   * @default "src/virtual-keys.generated.d.ts"
   */
  dtsPath?: string

  /**
   * Base locale to introspect for key-path generation.
   * @default "de"
   */
  baseLocale?: string

  /**
   * Optional banner comment at the top of the generated file.
   * If omitted, a deterministic banner without timestamps is emitted.
   */
  banner?: string

  /**
   * If true, the plugin will re-generate on every relevant file change in dev.
   * @default true
   */
  watchInDev?: boolean

  /**
   * Optional function to post-process the keys (e.g., sort, filter, dedupe).
   * @default Sort ascending and remove duplicates
   */
  transformKeys?: (keys: string[]) => string[]

  /**
   * Name for the generated union type (kept for compatibility).
   * @default "VirtualKey"
   */
  typeName?: string
}
```

## Example

### Basic Setup

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import unpluginVueI18nDtsGeneration from 'unplugin-vue-i18n-dts-generation'

export default defineConfig({
  plugins: [
    unpluginVueI18nDtsGeneration({
      sourceId: 'virtual:i18n-messages',
      dtsPath: 'src/types/i18n.d.ts',
      baseLocale: 'en',
    })
  ]
})
```

### Generated Output

The plugin will generate a TypeScript definition file with the following exports:

```typescript
// src/types/i18n.d.ts
// AUTO-GENERATED FILE. DO NOT EDIT.
// Generated by unplugin-vue-i18n-dts-generation (deterministic)
// Content-Hash: a1b2c3d4

declare const _SupportedLanguages: readonly ['en', 'de', 'fr']
const _messages = { /* your i18n message structure */ } as const

export type AllTranslationKeysGen = 'home.title' | 'home.description' | 'about.title' // ...
export type SupportedLanguagesGen = typeof _SupportedLanguages
export type SupportedLanguageUnionGen = typeof _SupportedLanguages[number]
export type AllTranslationsGen = typeof _messages
```

### Using the Generated Types

```typescript
import type { AllTranslationKeysGen, SupportedLanguagesGen } from '@/types/i18n'

// Type-safe i18n key usage
const translateKey = (key: AllTranslationKeysGen) => {
  // Your translation logic
}

// Type-safe language selection
const setLanguage = (lang: SupportedLanguagesGen[number]) => {
  // Your language switching logic
}
```

## How It Works

1. The plugin reads the specified virtual module using Vite's SSR module loading
2. It extracts and normalizes the i18n messages structure
3. Generates deterministic TypeScript definitions based on the message keys
4. Writes the definitions to the specified file path
5. In development mode, watches for changes and regenerates when needed

## Advanced Usage

### Custom Key Transformation

```typescript
unpluginVueI18nDtsGeneration({
  sourceId: 'virtual:i18n',
  transformKeys: (keys) => {
    // Filter out certain keys
    const filtered = keys.filter(k => !k.startsWith('internal.'))
    // Sort and dedupe
    return [...new Set(filtered)].sort()
  }
})
```

### Custom Banner

```typescript
unpluginVueI18nDtsGeneration({
  sourceId: 'virtual:i18n',
  banner: `// Generated by My App Build System
// Do not modify this file manually
`
})
```

## Requirements

- Node.js >= 18.0.0
- Vite >= 4.0.0

## Development

```bash
# Install dependencies
npm install

# Build the plugin
npm run build

# Run in watch mode
npm run dev

# Run tests
npm run test

# Lint code
npm run lint

# Type check
npm run typecheck
```

## License

MIT

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## Issues

If you find a bug or have a feature request, please open an issue on [GitHub](https://github.com/your-username/unplugin-vue-i18n-dts-generation/issues).